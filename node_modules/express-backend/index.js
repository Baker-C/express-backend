'use strict';

const express = require('express');
const cookieParser = require('cookie-parser');
const bodyParser = require('body-parser');

function convenience(req, res, next) {
  res.error = error => res.json({error});
  res.ok    = () => res.json({success: true});

  next();
}

function handleError(error, req, res, next) {
  console.error(error.stack);
  res.error('An unforeseen error has occurred.')
}

module.exports = function(opts) {
  var app = express();

  app.use(bodyParser.json());
  app.use(bodyParser.urlencoded({extended: false}));
  app.use(cookieParser('secret'));
  app.use(convenience);
  app.use(handleError);

  return app;
}
